<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>AgentBrain Controller</title>
<style>
  :root { --bg:#0b0f14; --fg:#eef2f7; --accent:#4ade80; --muted:#94a3b8; }
  body { background:var(--bg); color:var(--fg); font: 18px/1.5 system-ui,Segoe UI,Arial; margin:0; }
  header { padding:20px; text-align:center; }
  main { display:flex; flex-direction:column; gap:20px; padding:20px; max-width:700px; margin:0 auto; }
  button.big { font-size:28px; padding:24px; border-radius:16px; border:2px solid var(--accent); background:#0f172a; color:var(--fg); cursor:pointer; }
  button.big:focus { outline:4px solid #22d3ee; outline-offset:4px; }
  .row { display:grid; grid-template-columns:1fr; gap:16px; }
  .hint { color:var(--muted); font-size:16px; }
  @media (min-width:720px){ .row { grid-template-columns:1fr 1fr; } }
  a { color: var(--accent); }
  .sr { position:absolute; left:-9999px; }
  .ok { color: #22c55e; }
  .err { color: #ef4444; }
  #out { min-height: 1.5em; }
  .wrap { display:flex; gap:12px; align-items:center; }
  .linklike { text-align:center; display:block; text-decoration:none; padding:24px; border-radius:16px; border:2px solid var(--accent); background:#0f172a; color:var(--fg); }
  .linklike:focus { outline:4px solid #22d3ee; outline-offset:4px; }
  .grid2 { display:grid; grid-template-columns:1fr 1fr; gap:16px; }
</style>
</head>
<body>
  <header>
    <h1>AgentBrain Controller</h1>
    <p class="hint">Tab to move, Enter/Space to activate</p>
  </header>
  <main>
    <div class="row" role="group" aria-label="Controls">
      <button class="big" id="btnDictate" aria-describedby="dHint">Dictate</button>
      <span id="dHint" class="sr">Opens a prompt to input a spoken or typed command</span>
      <button class="big" id="btnStart">Start</button>
      <button class="big" id="btnStop">Stop</button>
      <a class="big linklike" href="/public/status.html">Status</a>
      <button class="big" id="btnRefresh">Refresh</button>
    </div>
    <div class="wrap">
      <strong>Status:</strong>
      <span class="hint" id="status">Loading...</span>
    </div>
    <p class="hint" id="out" role="status" aria-live="polite"></p>
    <section aria-labelledby="sec-live">
      <h2 id="sec-live" class="sr">Live Data</h2>
      <div class="grid2">
        <div>
          <h3>Status JSON</h3>
          <pre id="statusJson" aria-live="polite" style="min-height:120px"></pre>
        </div>
        <div>
          <div class="wrap" style="justify-content:space-between">
            <h3 style="margin:0">Logs (tail)</h3>
            <button class="big" id="btnLogs">Refresh Logs</button>
          </div>
          <pre id="logs" style="min-height:120px"></pre>
        </div>
      </div>
    </section>
  </main>
<script>
async function send(action, payload) {
  try {
    const headers = { 'Content-Type': 'application/json' };
    // Optionally include X-Agent-Token from localStorage
    const t = localStorage.getItem('agent_token');
    if (t) headers['X-Agent-Token'] = t;
    const res = await fetch('/api/command', {
      method:'POST', headers, body: JSON.stringify({ action, payload })
    });
    const data = await res.json();
    const out = document.getElementById('out');
    if (data.ok) { out.textContent = `OK: ${action}`; out.className='ok'; }
    else { out.textContent = data.error || 'Error'; out.className='err'; }
  } catch(e) {
    document.getElementById('out').textContent = 'Network error';
  }
}
async function refreshStatus(){
  try {
    const r = await fetch('/api/status');
    const j = await r.json();
    document.getElementById('status').textContent = j.status || '';
    document.getElementById('statusJson').textContent = JSON.stringify(j, null, 2);
  } catch(e) { document.getElementById('status').textContent=''; }
}
async function refreshLogs(){
  try {
    const r = await fetch('/api/logs?lines=200');
    const j = await r.json();
    if (j.ok) {
      document.getElementById('logs').textContent = (j.lines||[]).join('\n');
    }
  } catch(e) {}
}
btnStart.onclick=()=>send('start');
btnStop.onclick=()=>send('stop');
btnRefresh.onclick=()=>refreshStatus();
btnLogs.onclick=()=>refreshLogs();
btnDictate.onclick=()=>{ const c=prompt('Speak or type command:'); if(c) send('dictate',{text:c}); };
refreshStatus();
refreshLogs();
</script>
</body>
</html>
